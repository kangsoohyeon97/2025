import streamlit as st

# νμ΄μ§€ μ„¤μ •
st.set_page_config(page_title="μ·¨ν–¥ ν…μ¤νΈ & μ΄μƒν• μ¶”μ²", page_icon="π’–", layout="centered")

# μ„Έμ… μƒνƒ μ΄κΈ°ν™”
if "page" not in st.session_state:
    st.session_state.page = 0  # 0: μ΄λ¦„, 1: μ§λ¬Έ/μ·¨λ―Έ, 2: μ΄μƒν•
if "name" not in st.session_state:
    st.session_state.name = ""
if "answers" not in st.session_state:
    st.session_state.answers = {}

# μ§λ¬Έκ³Ό μ„ νƒμ§€
questions = [
    {"q": "μ‰¬λ” λ‚  κ°€μ¥ ν•κ³  μ‹¶μ€ ν™λ™μ€?", 
     "options": {"μ§‘μ—μ„ μ±… μ½κΈ°": ["λ‚΄ν–¥","μ‹¤λ‚΄"], "μΉκµ¬ λ§λ‚κΈ°": ["μ™Έν–¥"], "μ¦‰ν¥ μ—¬ν–‰": ["μμ ","μ‹¤μ™Έ"], "μ§‘μ•μΌ μ •λ¦¬": ["κ³„ν","μ‹¤λ‚΄"]}},
    {"q": "λ‹Ήμ‹ μ΄ μ¤νΈλ μ¤λ¥Ό ν’€ λ• μ£Όλ΅ ν•λ” λ°©λ²•μ€?", 
     "options": {"νΌμ λ…μƒν•κΈ°": ["λ‚΄ν–¥","μ‹¤λ‚΄"], "μΉκµ¬μ™€ μλ‹¤": ["μ™Έν–¥"], "μƒλ΅μ΄ ν™λ™ μ‹λ„": ["μμ "], "μ΄λ™ λ£¨ν‹΄ μ†ν™”": ["κ³„ν","μ‹¤μ™Έ"]}},
    {"q": "μ—¬ν–‰μ„ κ³„νν•  λ• μ¤νƒ€μΌμ€?", 
     "options": {"μ„Έλ¶€ μΌμ • κ³„ν": ["κ³„ν"], "μ¦‰ν¥μ  μ—¬ν–‰": ["μμ ","μ‹¤μ™Έ"], "νΌμ μ΅°μ©ν ν΄μ‹": ["λ‚΄ν–¥","μ‹¤λ‚΄"], "μ—¬λΏκ³Ό ν™λ™ μ¤‘μ‹¬": ["μ™Έν–¥","μ‹¤μ™Έ"]}},
    {"q": "μ£Όλ§ λ¨μ„μ—μ„ λ‹Ήμ‹  μ—­ν• μ€?", 
     "options": {"μ΅°μ©ν μ°Έμ—¬": ["λ‚΄ν–¥"], "μ£Όλ„μ μΌλ΅ μ§„ν–‰": ["μ™Έν–¥"], "μ¦‰ν¥μ  μ•„μ΄λ””μ–΄ μ κ³µ": ["μμ "], "λ―Έλ¦¬ μ¤€λΉ„λ κ³„ν μ§„ν–‰": ["κ³„ν"]}},
    {"q": "ν•λ£¨ μΌκ³Όμ—μ„ κ°€μ¥ μ¤‘μ”ν•κ² μƒκ°ν•λ” κ±΄?", 
     "options": {"νΌμλ§μ μ‹κ°„": ["λ‚΄ν–¥"], "μ‚¬λλ“¤κ³Ό μ†ν†µ": ["μ™Έν–¥"], "μ¦‰ν¥μ  μ¦κ±°μ›€": ["μμ "], "μ‹κ°„ κ³„ν μ² μ €": ["κ³„ν"]}},
    {"q": "λ…μ„λ¥Ό μ¦κΈΈ λ• μ¤νƒ€μΌμ€?", 
     "options": {"νΌμ μ΅°μ©ν μ½κΈ°": ["λ‚΄ν–¥","μ‹¤λ‚΄"], "ν† λ΅ ν•λ©° μ½κΈ°": ["μ™Έν–¥"], "μƒλ΅μ΄ μ¥λ¥΄ νƒμƒ‰": ["μμ "], "μ¶”μ² λ©λ΅ κΈ°λ° κ³„νμ  μ½κΈ°": ["κ³„ν"]}},
    {"q": "μμ•… μ·¨ν–¥μ€?", 
     "options": {"μ”μ”ν• μμ•…": ["λ‚΄ν–¥"], "μ‹ λ‚λ” μμ•…": ["μ™Έν–¥"], "λ‹¤μ–‘ν• μ¥λ¥΄ μ‹¤ν—": ["μμ "], "κ³„νλ ν”λ μ΄λ¦¬μ¤νΈ": ["κ³„ν"]}},
    {"q": "μ‡Όν•‘ μ¤νƒ€μΌμ€?", 
     "options": {"μ¨λΌμΈ νΌμ κµ¬λ§¤": ["λ‚΄ν–¥","μ‹¤λ‚΄"], "μΉκµ¬μ™€ κ°™μ΄ μ¦κΉ€": ["μ™Έν–¥"], "μ¦‰ν¥μ  μ„ νƒ": ["μμ "], "κ³„νλ λ¦¬μ¤νΈ κµ¬λ§¤": ["κ³„ν"]}},
    {"q": "μ΄λ™ μµκ΄€μ€?", 
     "options": {"νΌμ μ”κ°€/ν™νΈ": ["λ‚΄ν–¥","μ‹¤λ‚΄"], "ν€ μ¤ν¬μΈ /μ™Έλ¶€ ν™λ™": ["μ™Έν–¥","μ‹¤μ™Έ"], "μ¦‰ν¥μ μΌλ΅ μƒλ΅μ΄ μ΄λ™ λ„μ „": ["μμ ","μ‹¤μ™Έ"], "λ£¨ν‹΄ μ΄λ™": ["κ³„ν","μ‹¤λ‚΄"]}},
    {"q": "SNS ν™μ© μ¤νƒ€μΌμ€?", 
     "options": {"μ΅°μ©ν κµ¬κ²½": ["λ‚΄ν–¥"], "μμ£Ό μ†ν†µ": ["μ™Έν–¥"], "μƒλ΅μ΄ κΈ°λ¥ μ‹λ„": ["μμ "], "κ³„νμ μΌλ΅ ν¬μ¤ν…": ["κ³„ν"]}},
    {"q": "μ·¨λ―Έ ν™λ™μ€?", 
     "options": {"νΌμ μ΅°μ©ν μ¦κΈ°κΈ°": ["λ‚΄ν–¥","μ‹¤λ‚΄"], "μΉκµ¬μ™€ ν•¨κ» μ¦κΈ°κΈ°": ["μ™Έν–¥"], "μƒλ΅μ΄ μ·¨λ―Έ λ„μ „": ["μμ "], "μ •ν•΄μ§„ λ£¨ν‹΄ μ¦κΉ€": ["κ³„ν"]}},
    {"q": "μμ‹ μ„ νƒ κΈ°μ¤€μ€?", 
     "options": {"μ§‘λ°¥/νΈμ•ν•¨": ["λ‚΄ν–¥","μ‹¤λ‚΄"], "μΉκµ¬μ™€ μ¦κΉ€": ["μ™Έν–¥"], "μƒλ΅μ΄ μμ‹ νƒν—": ["μμ "], "κ³„νλ μ‹λ‹¨": ["κ³„ν"]}},
    {"q": "μν™”/λ“λΌλ§ μ·¨ν–¥μ€?", 
     "options": {"μ΅°μ©ν• λ“λΌλ§": ["λ‚΄ν–¥","μ‹¤λ‚΄"], "μ•΅μ…/μ½”λ―Έλ””": ["μ™Έν–¥"], "μ‹¤ν—μ  λ…λ¦½μν™”": ["μμ "], "μ •ν•΄μ§„ μ¥λ¥΄ μ¦κΉ€": ["κ³„ν"]}},
    {"q": "ν•™μµ/κ³µλ¶€ μ¤νƒ€μΌμ€?", 
     "options": {"νΌμ μ§‘μ¤‘": ["λ‚΄ν–¥","μ‹¤λ‚΄"], "κ·Έλ£Ή μ¤ν„°λ””": ["μ™Έν–¥"], "μƒλ΅μ΄ λ°©λ²• μ‹¤ν—": ["μμ "], "κ³„νν‘ λ”°λΌ ν•™μµ": ["κ³„ν"]}},
    {"q": "μ£Όλ§ μ™Έμ¶ μ¤νƒ€μΌμ€?", 
     "options": {"μ§‘μ—μ„ ν΄μ‹": ["λ‚΄ν–¥","μ‹¤λ‚΄"], "μΉκµ¬ λ¨μ„ μ°Έμ—¬": ["μ™Έν–¥"], "μ¦‰ν¥μ  μ—¬ν–‰": ["μμ ","μ‹¤μ™Έ"], "κ³„νλ μΌμ • μ†ν™”": ["κ³„ν"]}},
    {"q": "μ¤νΈλ μ¤ ν•΄μ† λ°©λ²•μ€?", 
     "options": {"νΌμ λ…μƒ": ["λ‚΄ν–¥","μ‹¤λ‚΄"], "μΉκµ¬μ™€ μλ‹¤": ["μ™Έν–¥"], "μ¦‰ν¥μ  ν™λ™": ["μμ ","μ‹¤μ™Έ"], "μ΄λ™ λ£¨ν‹΄": ["κ³„ν","μ‹¤λ‚΄"]}},
    {"q": "μ„ λ¬Ό κ³ λ¥΄λ” λ°©μ‹μ€?", 
     "options": {"νΌμ κ³ λ―Ό": ["λ‚΄ν–¥","μ‹¤λ‚΄"], "μΉκµ¬μ™€ μƒμ": ["μ™Έν–¥"], "μ¦‰ν¥μ /μ°½μμ  μ„ νƒ": ["μμ "], "λ¦¬μ¤νΈ κΈ°λ° κ³„ν μ„ νƒ": ["κ³„ν"]}},
    {"q": "μ—¬ν–‰ μ¤νƒ€μΌμ€?", 
     "options": {"νΈμ•ν•κ² νΌμ ν΄μ‹": ["λ‚΄ν–¥","μ‹¤λ‚΄"], "μ—¬λΏκ³Ό ν™λ™ μ¤‘μ‹¬": ["μ™Έν–¥","μ‹¤μ™Έ"], "μ¦‰ν¥μ  μ—¬ν–‰": ["μμ ","μ‹¤μ™Έ"], "μ„Έλ¶€ μΌμ • μ² μ € κ³„ν": ["κ³„ν"]}},
    {"q": "λ‹Ήμ‹ μ μ¥λ κ³„ν μ¤νƒ€μΌμ€?", 
     "options": {"μ¥κΈ° κ³„ν μ² μ €": ["κ³„ν"], "μ¦‰ν¥μ  κ²°μ • μ„ νΈ": ["μμ "], "νΌμμ„ μ°¨λ¶„ν μ¤€λΉ„": ["λ‚΄ν–¥"], "μ‚¬λλ“¤κ³Ό ν•¨κ» λ©ν‘ λ‹¬μ„±": ["μ™Έν–¥"]}}
]

# μ΄μƒν• λ§¤ν•‘
ideal_type_map = {
    ("λ‚΄ν–¥","κ³„ν","μ‹¤λ‚΄"): {"μ™Έμ ":"μ°¨λ¶„ν•κ³  λ‹¨μ •ν• μ¤νƒ€μΌ", "λ‚΄μ ":"μ±…μ„ μΆ‹μ•„ν•κ³  μ΅°μ©ν• μ„±κ²©"},
    ("λ‚΄ν–¥","μμ ","μ‹¤λ‚΄"): {"μ™Έμ ":"νΈμ•ν• μΊμ£Όμ–Ό μ¤νƒ€μΌ", "λ‚΄μ ":"μ°½μμ μ΄κ³  κ°μ„±μ μΈ μ„±κ²©"},
    ("μ™Έν–¥","κ³„ν","μ‹¤μ™Έ"): {"μ™Έμ ":"ν™λ™μ μΈ ν¨μ…", "λ‚΄μ ":"λ¦¬λ”μ‹­ μκ³  μ±…μ„κ° μλ” μ„±κ²©"},
    ("μ™Έν–¥","μμ ","μ‹¤μ™Έ"): {"μ™Έμ ":"μμ λ΅μ΄ ν¨μ…, κ°μ„± μλ” μ¤νƒ€μΌ", "λ‚΄μ ":"μ¦‰ν¥μ μ΄κ³  ν™λ°ν• μ„±κ²©"},
    ("μ™Έν–¥","μμ ","μ‹¤λ‚΄"): {"μ™Έμ ":"νΈλ λ””ν•κ³  μ¤νƒ€μΌλ¦¬μ‹", "λ‚΄μ ":"μ‚¬κµμ μ΄κ³  λ¨ν—μ‹¬ κ°•ν•¨"},
    ("λ‚΄ν–¥","κ³„ν","μ‹¤μ™Έ"): {"μ™Έμ ":"μμ—° μΉν™”μ  μ¤νƒ€μΌ", "λ‚΄μ ":"μ°¨λ¶„ν•κ³  κ³„νμ μΈ μ„±κ²©"},
    ("λ‚΄ν–¥","μμ ","μ‹¤μ™Έ"): {"μ™Έμ ":"νΈμ•ν• μ•„μ›ƒλ„μ–΄ μ¤νƒ€μΌ", "λ‚΄μ ":"νΈκΈ°μ‹¬ λ§κ³  μ°½μμ  μ„±κ²©"},
    ("μ™Έν–¥","κ³„ν","μ‹¤λ‚΄"): {"μ™Έμ ":"κΉ”λ”ν• λ„μ‹ μ¤νƒ€μΌ", "λ‚΄μ ":"μ²΄κ³„μ μ΄κ³  λ©ν‘ μ§€ν–¥μ  μ„±κ²©"},
}

# ---------------- νμ΄μ§€ 0: μ΄λ¦„ μ…λ ¥ ----------------
if st.session_state.page == 0:
    st.subheader("π‘‹ μ•λ…•ν•μ„Έμ”!")
    st.session_state.name = st.text_input("μ΄λ¦„μ„ μ…λ ¥ν•΄μ£Όμ„Έμ”:")
    if st.session_state.name:
        if st.button("λ‹¤μ"):
            st.session_state.page = 1
            st.experimental_rerun()

# ---------------- νμ΄μ§€ 1: μ§λ¬Έ + μ·¨λ―Έ μ¶”μ² ----------------
elif st.session_state.page == 1:
    st.subheader(f"π“ {st.session_state.name}λ‹, μ§λ¬Έμ— λ‹µν•΄μ£Όμ„Έμ”")

    # μ§λ¬Έ μ¶λ ¥
    for i, q in enumerate(questions):
        st.session_state.answers[i] = st.radio(
            f"{i+1}. {q['q']}",
            list(q["options"].keys()),
            key=f"q_{i}"
        )

    if st.button("μ·¨λ―Έ μ¶”μ² λ³΄κΈ°"):
        # μ μ κ³„μ‚°
        scores = {"λ‚΄ν–¥":0, "μ™Έν–¥":0, "κ³„ν":0, "μμ ":0, "μ‹¤λ‚΄":0, "μ‹¤μ™Έ":0}
        for i, q in enumerate(questions):
            ans = st.session_state.answers[i]
            traits = q["options"][ans]
            for t in traits:
                scores[t] += 1

        st.session_state.main_traits = [
            "λ‚΄ν–¥" if scores["λ‚΄ν–¥"] >= scores["μ™Έν–¥"] else "μ™Έν–¥",
            "κ³„ν" if scores["κ³„ν"] >= scores["μμ "] else "μμ ",
            "μ‹¤λ‚΄" if scores["μ‹¤λ‚΄"] >= scores["μ‹¤μ™Έ"] else "μ‹¤μ™Έ"
        ]

        # μ·¨λ―Έ μ¶”μ² λ§¤ν•‘
        hobby_map = {
            ("λ‚΄ν–¥","κ³„ν","μ‹¤λ‚΄"): ["λ…μ„", "νΌμ¦ λ§μ¶”κΈ°", "κΈ€μ“°κΈ°"],
            ("λ‚΄ν–¥","μμ ","μ‹¤λ‚΄"): ["κ·Έλ¦Ό κ·Έλ¦¬κΈ°", "λ„·ν”λ¦­μ¤ κ°μƒ", "μ”λ¦¬"],
            ("μ™Έν–¥","κ³„ν","μ‹¤μ™Έ"): ["λ“±μ‚°", "μμ „κ±° νƒ€κΈ°", "λ‹¨μ²΄ μ¤ν¬μΈ "],
            ("μ™Έν–¥","μμ ","μ‹¤μ™Έ"): ["μ—¬ν–‰", "λ„μ¤", "λ³΄λ“κ²μ„ λ¨μ„"],
            ("μ™Έν–¥","μμ ","μ‹¤λ‚΄"): ["μ•…κΈ° μ—°μ£Ό", "λ³΄λ“κ²μ„", "μΏ ν‚Ή ν΄λμ¤"],
            ("λ‚΄ν–¥","κ³„ν","μ‹¤μ™Έ"): ["μ‚¬μ§„ μ°κΈ°", "μ΅°κΉ…", "μ •μ› κ°€κΎΈκΈ°"],
            ("λ‚΄ν–¥","μμ ","μ‹¤μ™Έ"): ["μΊ ν•‘", "μμ „κ±° μ—¬ν–‰", "μ‚¬μ§„ μ°κΈ°"],
            ("μ™Έν–¥","κ³„ν","μ‹¤λ‚΄"): ["μ”κ°€ ν΄λμ¤", "ν—¬μ¤", "κ·Έλ£Ή ν™λ™"],
        }
        st.subheader("π‰ μ¶”μ² μ·¨λ―Έ")
        for h in hobby_map.get(tuple(st.session_state.main_traits), ["λ…μƒ", "μ‚°μ±…", "μ”λ¦¬"]):
            st.write(f"- {h}")

        if st.button("μ΄μƒν• μ¶”μ² λ³΄κΈ°"):
            st.session_state.page = 2
            st.experimental_rerun()

# ---------------- νμ΄μ§€ 2: μ΄μƒν• μ¶”μ² ----------------
elif st.session_state.page == 2:
    st.subheader(f"π’– {st.session_state.name}λ‹μ μ΄μƒν• νΉμ§•")
    main_traits = tuple(st.session_state.main_traits)
    ideal = ideal_type_map.get(main_traits, {"μ™Έμ ":"λ¨λν• μ¤νƒ€μΌ", "λ‚΄μ ":"μΉκ·Όν•κ³  κΈμ •μ μΈ μ„±κ²©"})
    st.write(f"**μ™Έμ  νΉμ§•:** {ideal['μ™Έμ ']}")
    st.write(f"**λ‚΄μ  νΉμ§•:** {ideal['λ‚΄μ ']}")
