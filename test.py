import streamlit as st

# í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="ì·¨í–¥ í…ŒìŠ¤íŠ¸ & ì´ìƒí˜• ì¶”ì²œ", page_icon="ğŸ’–", layout="centered")

# ---------------- ì„¸ì…˜ ì´ˆê¸°í™” ----------------
if "page" not in st.session_state:
    st.session_state.page = 0  # 0: ì´ë¦„ ì…ë ¥, 1: ì§ˆë¬¸/ì·¨ë¯¸, 2: ì´ìƒí˜•
if "name" not in st.session_state:
    st.session_state.name = ""
if "answers" not in st.session_state:
    st.session_state.answers = {}
if "main_traits" not in st.session_state:
    st.session_state.main_traits = []

# ---------------- ì§ˆë¬¸ ë°ì´í„° ----------------
questions = [
    {"q": "ì‰¬ëŠ” ë‚  ê°€ì¥ í•˜ê³  ì‹¶ì€ í™œë™ì€?", 
     "options": {"ì§‘ì—ì„œ ì±… ì½ê¸°": ["ë‚´í–¥","ì‹¤ë‚´"], "ì¹œêµ¬ ë§Œë‚˜ê¸°": ["ì™¸í–¥"], "ì¦‰í¥ ì—¬í–‰": ["ììœ ","ì‹¤ì™¸"], "ì§‘ì•ˆì¼ ì •ë¦¬": ["ê³„íš","ì‹¤ë‚´"]}},
    {"q": "ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ ë°©ë²•ì€?", 
     "options": {"í˜¼ì ëª…ìƒí•˜ê¸°": ["ë‚´í–¥","ì‹¤ë‚´"], "ì¹œêµ¬ì™€ ìˆ˜ë‹¤": ["ì™¸í–¥"], "ìƒˆë¡œìš´ í™œë™ ì‹œë„": ["ììœ "], "ìš´ë™ ë£¨í‹´ ì†Œí™”": ["ê³„íš","ì‹¤ì™¸"]}},
    {"q": "ì—¬í–‰ ê³„íš ìŠ¤íƒ€ì¼ì€?", 
     "options": {"ì„¸ë¶€ ì¼ì • ê³„íš": ["ê³„íš"], "ì¦‰í¥ì  ì—¬í–‰": ["ììœ ","ì‹¤ì™¸"], "í˜¼ì íœ´ì‹": ["ë‚´í–¥","ì‹¤ë‚´"], "ì—¬ëŸ¿ê³¼ í™œë™ ì¤‘ì‹¬": ["ì™¸í–¥","ì‹¤ì™¸"]}},
    {"q": "ì£¼ë§ ëª¨ì„ì—ì„œ ì—­í• ì€?", 
     "options": {"ì¡°ìš©íˆ ì°¸ì—¬": ["ë‚´í–¥"], "ì£¼ë„ì ìœ¼ë¡œ ì§„í–‰": ["ì™¸í–¥"], "ì¦‰í¥ ì•„ì´ë””ì–´ ì œê³µ": ["ììœ "], "ë¯¸ë¦¬ ì¤€ë¹„ëœ ê³„íš ì§„í–‰": ["ê³„íš"]}},
    {"q": "í•˜ë£¨ ì¼ê³¼ì—ì„œ ì¤‘ìš”ì‹œí•˜ëŠ” ê²ƒì€?", 
     "options": {"í˜¼ìë§Œì˜ ì‹œê°„": ["ë‚´í–¥"], "ì‚¬ëŒë“¤ê³¼ ì†Œí†µ": ["ì™¸í–¥"], "ì¦‰í¥ì  ì¦ê±°ì›€": ["ììœ "], "ì‹œê°„ ê³„íš ì² ì €": ["ê³„íš"]}},
    {"q": "ë…ì„œë¥¼ ì¦ê¸°ëŠ” ë°©ì‹ì€?", 
     "options": {"í˜¼ì ì¡°ìš©íˆ ì½ê¸°": ["ë‚´í–¥","ì‹¤ë‚´"], "í† ë¡ í•˜ë©° ì½ê¸°": ["ì™¸í–¥"], "ìƒˆë¡œìš´ ì¥ë¥´ íƒìƒ‰": ["ììœ "], "ì¶”ì²œ ëª©ë¡ ê¸°ë°˜ ê³„íšì  ì½ê¸°": ["ê³„íš"]}},
    {"q": "ìŒì•… ì·¨í–¥ì€?", 
     "options": {"ì”ì”í•œ ìŒì•…": ["ë‚´í–¥"], "ì‹ ë‚˜ëŠ” ìŒì•…": ["ì™¸í–¥"], "ë‹¤ì–‘í•œ ì¥ë¥´ ì‹¤í—˜": ["ììœ "], "ê³„íšëœ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸": ["ê³„íš"]}},
    {"q": "ì‡¼í•‘ ìŠ¤íƒ€ì¼ì€?", 
     "options": {"ì˜¨ë¼ì¸ í˜¼ì êµ¬ë§¤": ["ë‚´í–¥","ì‹¤ë‚´"], "ì¹œêµ¬ì™€ í•¨ê»˜": ["ì™¸í–¥"], "ì¦‰í¥ì  ì„ íƒ": ["ììœ "], "ê³„íšëœ ë¦¬ìŠ¤íŠ¸ êµ¬ë§¤": ["ê³„íš"]}},
    {"q": "ìš´ë™ ìŠµê´€ì€?", 
     "options": {"í˜¼ì ìš”ê°€/í™ˆíŠ¸": ["ë‚´í–¥","ì‹¤ë‚´"], "íŒ€ ìŠ¤í¬ì¸ /ì™¸ë¶€ í™œë™": ["ì™¸í–¥","ì‹¤ì™¸"], "ìƒˆë¡œìš´ ìš´ë™ ë„ì „": ["ììœ ","ì‹¤ì™¸"], "ë£¨í‹´ ìš´ë™": ["ê³„íš","ì‹¤ë‚´"]}},
    {"q": "SNS í™œìš© ìŠ¤íƒ€ì¼ì€?", 
     "options": {"ì¡°ìš©íˆ êµ¬ê²½": ["ë‚´í–¥"], "ìì£¼ ì†Œí†µ": ["ì™¸í–¥"], "ìƒˆ ê¸°ëŠ¥ ì‹œë„": ["ììœ "], "ê³„íšì ìœ¼ë¡œ í¬ìŠ¤íŒ…": ["ê³„íš"]}},
    {"q": "ì·¨ë¯¸ í™œë™ì€?", 
     "options": {"í˜¼ì ì¡°ìš©íˆ ì¦ê¸°ê¸°": ["ë‚´í–¥","ì‹¤ë‚´"], "ì¹œêµ¬ì™€ í•¨ê»˜ ì¦ê¸°ê¸°": ["ì™¸í–¥"], "ìƒˆë¡œìš´ ì·¨ë¯¸ ë„ì „": ["ììœ "], "ì •í•´ì§„ ë£¨í‹´ ì¦ê¹€": ["ê³„íš"]}},
    {"q": "ìŒì‹ ì„ íƒ ê¸°ì¤€ì€?", 
     "options": {"ì§‘ë°¥/í¸ì•ˆí•¨": ["ë‚´í–¥","ì‹¤ë‚´"], "ì¹œêµ¬ì™€ ì¦ê¹€": ["ì™¸í–¥"], "ìƒˆë¡œìš´ ìŒì‹ íƒí—˜": ["ììœ "], "ê³„íšëœ ì‹ë‹¨": ["ê³„íš"]}},
    {"q": "ì˜í™”/ë“œë¼ë§ˆ ì·¨í–¥ì€?", 
     "options": {"ì¡°ìš©í•œ ë“œë¼ë§ˆ": ["ë‚´í–¥","ì‹¤ë‚´"], "ì•¡ì…˜/ì½”ë¯¸ë””": ["ì™¸í–¥"], "ì‹¤í—˜ì  ë…ë¦½ì˜í™”": ["ììœ "], "ì •í•´ì§„ ì¥ë¥´ ì¦ê¹€": ["ê³„íš"]}},
    {"q": "í•™ìŠµ/ê³µë¶€ ìŠ¤íƒ€ì¼ì€?", 
     "options": {"í˜¼ì ì§‘ì¤‘": ["ë‚´í–¥","ì‹¤ë‚´"], "ê·¸ë£¹ ìŠ¤í„°ë””": ["ì™¸í–¥"], "ìƒˆë¡œìš´ ë°©ë²• ì‹¤í—˜": ["ììœ "], "ê³„íší‘œ ë”°ë¼ í•™ìŠµ": ["ê³„íš"]}},
    {"q": "ì£¼ë§ ì™¸ì¶œ ìŠ¤íƒ€ì¼ì€?", 
     "options": {"ì§‘ì—ì„œ íœ´ì‹": ["ë‚´í–¥","ì‹¤ë‚´"], "ì¹œêµ¬ ëª¨ì„ ì°¸ì—¬": ["ì™¸í–¥"], "ì¦‰í¥ì  ì—¬í–‰": ["ììœ ","ì‹¤ì™¸"], "ê³„íšëœ ì¼ì • ì†Œí™”": ["ê³„íš"]}},
    {"q": "ì„ ë¬¼ ê³ ë¥´ëŠ” ë°©ì‹ì€?", 
     "options": {"í˜¼ì ê³ ë¯¼": ["ë‚´í–¥","ì‹¤ë‚´"], "ì¹œêµ¬ì™€ ìƒì˜": ["ì™¸í–¥"], "ì¦‰í¥ì /ì°½ì˜ì  ì„ íƒ": ["ììœ "], "ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ ê³„íš ì„ íƒ": ["ê³„íš"]}},
    {"q": "ì—¬í–‰ ìŠ¤íƒ€ì¼ì€?", 
     "options": {"í˜¼ì íœ´ì‹": ["ë‚´í–¥","ì‹¤ë‚´"], "ì—¬ëŸ¿ê³¼ í™œë™": ["ì™¸í–¥","ì‹¤ì™¸"], "ì¦‰í¥ ì—¬í–‰": ["ììœ ","ì‹¤ì™¸"], "ì„¸ë¶€ ì¼ì • ê³„íš": ["ê³„íš"]}},
    {"q": "ì¥ë˜ ê³„íš ìŠ¤íƒ€ì¼ì€?", 
     "options": {"ì¥ê¸° ê³„íš ì² ì €": ["ê³„íš"], "ì¦‰í¥ì  ê²°ì •": ["ììœ "], "í˜¼ì ì¤€ë¹„": ["ë‚´í–¥"], "ì‚¬ëŒê³¼ í•¨ê»˜ ëª©í‘œ ë‹¬ì„±": ["ì™¸í–¥"]}},
    {"q": "ì·¨ì¹¨/íœ´ì‹ ìŠ¤íƒ€ì¼ì€?", 
     "options": {"ì¡°ìš©íˆ í˜¼ì ì‰¬ê¸°": ["ë‚´í–¥","ì‹¤ë‚´"], "ì¹œêµ¬ì™€ ì™¸ì¶œ í›„ íœ´ì‹": ["ì™¸í–¥"], "ì¦‰í¥ì  ë‚˜ë“¤ì´ í›„ íœ´ì‹": ["ììœ ","ì‹¤ì™¸"], "ê·œì¹™ì ì¸ ë£¨í‹´ ìœ ì§€": ["ê³„íš","ì‹¤ë‚´"]}}
]

# ì´ìƒí˜• ë§¤í•‘
ideal_type_map = {
    ("ë‚´í–¥","ê³„íš","ì‹¤ë‚´"): {"ì™¸ì ":"ì°¨ë¶„í•˜ê³  ë‹¨ì •í•œ ìŠ¤íƒ€ì¼", "ë‚´ì ":"ì±…ì„ ì¢‹ì•„í•˜ê³  ì¡°ìš©í•œ ì„±ê²©"},
    ("ë‚´í–¥","ììœ ","ì‹¤ë‚´"): {"ì™¸ì ":"í¸ì•ˆí•œ ìºì£¼ì–¼ ìŠ¤íƒ€ì¼", "ë‚´ì ":"ì°½ì˜ì ì´ê³  ê°ì„±ì ì¸ ì„±ê²©"},
    ("ì™¸í–¥","ê³„íš","ì‹¤ì™¸"): {"ì™¸ì ":"í™œë™ì ì¸ íŒ¨ì…˜", "ë‚´ì ":"ë¦¬ë”ì‹­ ìˆê³  ì±…ì„ê° ìˆëŠ” ì„±ê²©"},
    ("ì™¸í–¥","ììœ ","ì‹¤ì™¸"): {"ì™¸ì ":"ììœ ë¡œìš´ íŒ¨ì…˜, ê°œì„± ìˆëŠ” ìŠ¤íƒ€ì¼", "ë‚´ì ":"ì¦‰í¥ì ì´ê³  í™œë°œí•œ ì„±ê²©"},
    ("ì™¸í–¥","ììœ ","ì‹¤ë‚´"): {"ì™¸ì ":"íŠ¸ë Œë””í•˜ê³  ìŠ¤íƒ€ì¼ë¦¬ì‹œ", "ë‚´ì ":"ì‚¬êµì ì´ê³  ëª¨í—˜ì‹¬ ê°•í•¨"},
    ("ë‚´í–¥","ê³„íš","ì‹¤ì™¸"): {"ì™¸ì ":"ìì—° ì¹œí™”ì  ìŠ¤íƒ€ì¼", "ë‚´ì ":"ì°¨ë¶„í•˜ê³  ê³„íšì ì¸ ì„±ê²©"},
    ("ë‚´í–¥","ììœ ","ì‹¤ì™¸"): {"ì™¸ì ":"í¸ì•ˆí•œ ì•„ì›ƒë„ì–´ ìŠ¤íƒ€ì¼", "ë‚´ì ":"í˜¸ê¸°ì‹¬ ë§ê³  ì°½ì˜ì  ì„±ê²©"},
    ("ì™¸í–¥","ê³„íš","ì‹¤ë‚´"): {"ì™¸ì ":"ê¹”ë”í•œ ë„ì‹œ ìŠ¤íƒ€ì¼", "ë‚´ì ":"ì²´ê³„ì ì´ê³  ëª©í‘œ ì§€í–¥ì  ì„±ê²©"},
}

# ì·¨ë¯¸ ì¶”ì²œ ë§¤í•‘
hobby_map = {
    ("ë‚´í–¥","ê³„íš","ì‹¤ë‚´"): ["ë…ì„œ", "í¼ì¦ ë§ì¶”ê¸°", "ê¸€ì“°ê¸°"],
    ("ë‚´í–¥","ììœ ","ì‹¤ë‚´"): ["ê·¸ë¦¼ ê·¸ë¦¬ê¸°", "ë„·í”Œë¦­ìŠ¤ ê°ìƒ", "ìš”ë¦¬"],
    ("ì™¸í–¥","ê³„íš","ì‹¤ì™¸"): ["ë“±ì‚°", "ìì „ê±° íƒ€ê¸°", "ë‹¨ì²´ ìŠ¤í¬ì¸ "],
    ("ì™¸í–¥","ììœ ","ì‹¤ì™¸"): ["ì—¬í–‰", "ëŒ„ìŠ¤", "ë³´ë“œê²Œì„ ëª¨ì„"],
    ("ì™¸í–¥","ììœ ","ì‹¤ë‚´"): ["ì•…ê¸° ì—°ì£¼", "ë³´ë“œê²Œì„", "ì¿ í‚¹ í´ë˜ìŠ¤"],
    ("ë‚´í–¥","ê³„íš","ì‹¤ì™¸"): ["ì‚¬ì§„ ì°ê¸°", "ì¡°ê¹…", "ì •ì› ê°€ê¾¸ê¸°"],
    ("ë‚´í–¥","ììœ ","ì‹¤ì™¸"): ["ìº í•‘", "ìì „ê±° ì—¬í–‰", "ì‚¬ì§„ ì°ê¸°"],
    ("ì™¸í–¥","ê³„íš","ì‹¤ë‚´"): ["ìš”ê°€ í´ë˜ìŠ¤", "í—¬ìŠ¤", "ê·¸ë£¹ í™œë™"],
}

# ---------------- í˜ì´ì§€ 0: ì´ë¦„ ì…ë ¥ ----------------
if st.session_state.page == 0:
    st.subheader("ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”!")
    st.session_state.name = st.text_input("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:")
    if st.session_state.name:
        if st.button("ë‹¤ìŒ"):
            st.session_state.page = 1
            st.experimental_rerun()

# ---------------- í˜ì´ì§€ 1: ì§ˆë¬¸ + ì·¨ë¯¸ ì¶”ì²œ ----------------
elif st.session_state.page == 1:
    st.subheader(f"ğŸ“ {st.session_state.name}ë‹˜, ì§ˆë¬¸ì— ë‹µí•´ì£¼ì„¸ìš”")

    for i, q in enumerate(questions):
        st.session_state.answers[i] = st.radio(
            f"{i+1}. {q['q']}",
            list(q["options"].keys()),
            key=f"q_{i}"
        )

    if st.button("ì·¨ë¯¸ ì¶”ì²œ ë³´ê¸°"):
        scores = {"ë‚´í–¥":0, "ì™¸í–¥":0, "ê³„íš":0, "ììœ ":0, "ì‹¤ë‚´":0, "ì‹¤ì™¸":0}
        for i, q in enumerate(questions):
            ans = st.session_state.answers[i]
            traits = q["options"][ans]
            for t in traits:
                scores[t] += 1

        st.session_state.main_traits = [
            "ë‚´í–¥" if scores["ë‚´í–¥"] >= scores["ì™¸í–¥"] else "ì™¸í–¥",
            "ê³„íš" if scores["ê³„íš"] >= scores["ììœ "] else "ììœ ",
            "ì‹¤ë‚´" if scores["ì‹¤ë‚´"] >= scores["ì‹¤ì™¸"] else "ì‹¤ì™¸"
        ]

        st.subheader("ğŸ‰ ì¶”ì²œ ì·¨ë¯¸")
        for h in hobby_map.get(tuple(st.session_state.main_traits), ["ëª…ìƒ", "ì‚°ì±…", "ìš”ë¦¬"]):
            st.write(f"- {h}")

        if st.button("ì´ìƒí˜• ì¶”ì²œ ë³´ê¸°"):
            st.session_state.page = 2
            st.experimental_rerun()

# ---------------- í˜ì´ì§€ 2: ì´ìƒí˜• ì¶”ì²œ ----------------
elif st.session_state.page == 2:
    st.subheader(f"ğŸ’– {st.session_state.name}ë‹˜ì˜ ì´ìƒí˜• íŠ¹ì§•")
    main_traits = tuple(st.session_state.main_traits)
    ideal = ideal_type_map.get(main_traits, {"ì™¸ì ":"ëª¨ë˜í•œ ìŠ¤íƒ€ì¼", "ë‚´ì ":"ì¹œê·¼í•˜ê³  ê¸ì •ì ì¸ ì„±ê²©"})
    st.write(f"**ì™¸ì  íŠ¹ì§•:** {ideal['ì™¸ì ']}")
    st.write(f"**ë‚´ì  íŠ¹ì§•:** {ideal['ë‚´ì ']}")
