import streamlit as st

# 페이지 설정
st.set_page_config(page_title="취향 테스트 & 이상형 추천", page_icon="💖", layout="centered")

# 세션 상태 초기화
if "page" not in st.session_state:
    st.session_state.page = 0  # 0: 이름, 1: 질문/취미, 2: 이상형
if "name" not in st.session_state:
    st.session_state.name = ""
if "answers" not in st.session_state:
    st.session_state.answers = {}

# 질문과 선택지
questions = [
    {"q": "쉬는 날 가장 하고 싶은 활동은?", 
     "options": {"집에서 책 읽기": ["내향","실내"], "친구 만나기": ["외향"], "즉흥 여행": ["자유","실외"], "집안일 정리": ["계획","실내"]}},
    {"q": "당신이 스트레스를 풀 때 주로 하는 방법은?", 
     "options": {"혼자 명상하기": ["내향","실내"], "친구와 수다": ["외향"], "새로운 활동 시도": ["자유"], "운동 루틴 소화": ["계획","실외"]}},
    {"q": "여행을 계획할 때 스타일은?", 
     "options": {"세부 일정 계획": ["계획"], "즉흥적 여행": ["자유","실외"], "혼자 조용히 휴식": ["내향","실내"], "여럿과 활동 중심": ["외향","실외"]}},
    {"q": "주말 모임에서 당신 역할은?", 
     "options": {"조용히 참여": ["내향"], "주도적으로 진행": ["외향"], "즉흥적 아이디어 제공": ["자유"], "미리 준비된 계획 진행": ["계획"]}},
    {"q": "하루 일과에서 가장 중요하게 생각하는 건?", 
     "options": {"혼자만의 시간": ["내향"], "사람들과 소통": ["외향"], "즉흥적 즐거움": ["자유"], "시간 계획 철저": ["계획"]}},
    {"q": "독서를 즐길 때 스타일은?", 
     "options": {"혼자 조용히 읽기": ["내향","실내"], "토론하며 읽기": ["외향"], "새로운 장르 탐색": ["자유"], "추천 목록 기반 계획적 읽기": ["계획"]}},
    {"q": "음악 취향은?", 
     "options": {"잔잔한 음악": ["내향"], "신나는 음악": ["외향"], "다양한 장르 실험": ["자유"], "계획된 플레이리스트": ["계획"]}},
    {"q": "쇼핑 스타일은?", 
     "options": {"온라인 혼자 구매": ["내향","실내"], "친구와 같이 즐김": ["외향"], "즉흥적 선택": ["자유"], "계획된 리스트 구매": ["계획"]}},
    {"q": "운동 습관은?", 
     "options": {"혼자 요가/홈트": ["내향","실내"], "팀 스포츠/외부 활동": ["외향","실외"], "즉흥적으로 새로운 운동 도전": ["자유","실외"], "루틴 운동": ["계획","실내"]}},
    {"q": "SNS 활용 스타일은?", 
     "options": {"조용히 구경": ["내향"], "자주 소통": ["외향"], "새로운 기능 시도": ["자유"], "계획적으로 포스팅": ["계획"]}},
    {"q": "취미 활동은?", 
     "options": {"혼자 조용히 즐기기": ["내향","실내"], "친구와 함께 즐기기": ["외향"], "새로운 취미 도전": ["자유"], "정해진 루틴 즐김": ["계획"]}},
    {"q": "음식 선택 기준은?", 
     "options": {"집밥/편안함": ["내향","실내"], "친구와 즐김": ["외향"], "새로운 음식 탐험": ["자유"], "계획된 식단": ["계획"]}},
    {"q": "영화/드라마 취향은?", 
     "options": {"조용한 드라마": ["내향","실내"], "액션/코미디": ["외향"], "실험적 독립영화": ["자유"], "정해진 장르 즐김": ["계획"]}},
    {"q": "학습/공부 스타일은?", 
     "options": {"혼자 집중": ["내향","실내"], "그룹 스터디": ["외향"], "새로운 방법 실험": ["자유"], "계획표 따라 학습": ["계획"]}},
    {"q": "주말 외출 스타일은?", 
     "options": {"집에서 휴식": ["내향","실내"], "친구 모임 참여": ["외향"], "즉흥적 여행": ["자유","실외"], "계획된 일정 소화": ["계획"]}},
    {"q": "스트레스 해소 방법은?", 
     "options": {"혼자 명상": ["내향","실내"], "친구와 수다": ["외향"], "즉흥적 활동": ["자유","실외"], "운동 루틴": ["계획","실내"]}},
    {"q": "선물 고르는 방식은?", 
     "options": {"혼자 고민": ["내향","실내"], "친구와 상의": ["외향"], "즉흥적/창의적 선택": ["자유"], "리스트 기반 계획 선택": ["계획"]}},
    {"q": "여행 스타일은?", 
     "options": {"편안하게 혼자 휴식": ["내향","실내"], "여럿과 활동 중심": ["외향","실외"], "즉흥적 여행": ["자유","실외"], "세부 일정 철저 계획": ["계획"]}},
    {"q": "당신의 장래 계획 스타일은?", 
     "options": {"장기 계획 철저": ["계획"], "즉흥적 결정 선호": ["자유"], "혼자서 차분히 준비": ["내향"], "사람들과 함께 목표 달성": ["외향"]}}
]

# 이상형 매핑
ideal_type_map = {
    ("내향","계획","실내"): {"외적":"차분하고 단정한 스타일", "내적":"책을 좋아하고 조용한 성격"},
    ("내향","자유","실내"): {"외적":"편안한 캐주얼 스타일", "내적":"창의적이고 감성적인 성격"},
    ("외향","계획","실외"): {"외적":"활동적인 패션", "내적":"리더십 있고 책임감 있는 성격"},
    ("외향","자유","실외"): {"외적":"자유로운 패션, 개성 있는 스타일", "내적":"즉흥적이고 활발한 성격"},
    ("외향","자유","실내"): {"외적":"트렌디하고 스타일리시", "내적":"사교적이고 모험심 강함"},
    ("내향","계획","실외"): {"외적":"자연 친화적 스타일", "내적":"차분하고 계획적인 성격"},
    ("내향","자유","실외"): {"외적":"편안한 아웃도어 스타일", "내적":"호기심 많고 창의적 성격"},
    ("외향","계획","실내"): {"외적":"깔끔한 도시 스타일", "내적":"체계적이고 목표 지향적 성격"},
}

# ---------------- 페이지 0: 이름 입력 ----------------
if st.session_state.page == 0:
    st.subheader("👋 안녕하세요!")
    st.session_state.name = st.text_input("이름을 입력해주세요:")
    if st.session_state.name:
        if st.button("다음"):
            st.session_state.page = 1
            st.experimental_rerun()

# ---------------- 페이지 1: 질문 + 취미 추천 ----------------
elif st.session_state.page == 1:
    st.subheader(f"📝 {st.session_state.name}님, 질문에 답해주세요")

    # 질문 출력
    for i, q in enumerate(questions):
        st.session_state.answers[i] = st.radio(
            f"{i+1}. {q['q']}",
            list(q["options"].keys()),
            key=f"q_{i}"
        )

    if st.button("취미 추천 보기"):
        # 점수 계산
        scores = {"내향":0, "외향":0, "계획":0, "자유":0, "실내":0, "실외":0}
        for i, q in enumerate(questions):
            ans = st.session_state.answers[i]
            traits = q["options"][ans]
            for t in traits:
                scores[t] += 1

        st.session_state.main_traits = [
            "내향" if scores["내향"] >= scores["외향"] else "외향",
            "계획" if scores["계획"] >= scores["자유"] else "자유",
            "실내" if scores["실내"] >= scores["실외"] else "실외"
        ]

        # 취미 추천 매핑
        hobby_map = {
            ("내향","계획","실내"): ["독서", "퍼즐 맞추기", "글쓰기"],
            ("내향","자유","실내"): ["그림 그리기", "넷플릭스 감상", "요리"],
            ("외향","계획","실외"): ["등산", "자전거 타기", "단체 스포츠"],
            ("외향","자유","실외"): ["여행", "댄스", "보드게임 모임"],
            ("외향","자유","실내"): ["악기 연주", "보드게임", "쿠킹 클래스"],
            ("내향","계획","실외"): ["사진 찍기", "조깅", "정원 가꾸기"],
            ("내향","자유","실외"): ["캠핑", "자전거 여행", "사진 찍기"],
            ("외향","계획","실내"): ["요가 클래스", "헬스", "그룹 활동"],
        }
        st.subheader("🎉 추천 취미")
        for h in hobby_map.get(tuple(st.session_state.main_traits), ["명상", "산책", "요리"]):
            st.write(f"- {h}")

        if st.button("이상형 추천 보기"):
            st.session_state.page = 2
            st.experimental_rerun()

# ---------------- 페이지 2: 이상형 추천 ----------------
elif st.session_state.page == 2:
    st.subheader(f"💖 {st.session_state.name}님의 이상형 특징")
    main_traits = tuple(st.session_state.main_traits)
    ideal = ideal_type_map.get(main_traits, {"외적":"모던한 스타일", "내적":"친근하고 긍정적인 성격"})
    st.write(f"**외적 특징:** {ideal['외적']}")
    st.write(f"**내적 특징:** {ideal['내적']}")
